<!DOCTYPE html>
<html>

<head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
    <link rel="stylesheet" href="{{url_for('static', filename='css/style.css')}}" type="text/css" />
</head>

<body>
    <div class="navbar-fixed">
        <nav>
            <div class="nav-wrapper">
                <a href="https://bake-book-milestone.herokuapp.com/" class="brand-logo">BakeBook</a>
                <ul id="nav-mobile" class="right hide-on-med-and-down">
                    <li><a href="https://bake-book-milestone.herokuapp.com/">Home</a></li>
                    <li><a href="#">About</a></li>
                    <li><a href="{{url_for('my_saved_recipes')}}">Saved Recipes</a></li> <!-- putting link here for now while sorting out dropdown-->
                    {% if session %}
                    <li><a href="{{url_for('submit_recipe')}}">Submit a recipe</a></li>
                    <!--Dropdown content -->
                    <ul id='dropdown' class='nav-dropdown-content'>
                        <li><a href="{{url_for('logout')}}">Logout</a></li>
                        <li><a href="{{url_for('my_recipes')}}">My Recipes</a></li>
                        <li><a href="{{url_for('my_saved_recipes')}}">Saved Recipes</a></li>
                    </ul>
                    <!--Dropdown trigger -->
                    <li><a class='nav-dropdown'>{{ session['username'] }}</a></li>
                    {% else %}
                    <li><a href="{{url_for('login')}}">Login / Sign Up</a></li>
                    {% endif %}
                </ul>
            </div>
        </nav>
    </div>
    {% with messages = get_flashed_messages() %}
	  {% if messages %}
	    {% for message in messages %}
		  <div class="alert alert-warning alert-dismissible" role="alert">
			{{message}}
		  </div>
		{% endfor %}
	  {% endif %}
	{% endwith %}
    {% block content %} {% endblock %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
    <script type="text/javascript">
        function removeInput(e) {
            e.parentElement.remove(e.parentElement);
        }

        $(document).ready(function() {
            
            $(".nav-dropdown").click(function() {
                if ($(".nav-dropdown-content").hasClass("nav-dropdown-visible")) {
                    $(".nav-dropdown-content").removeClass("nav-dropdown-visible");
                }
                else {
                    $(".nav-dropdown-content").addClass("nav-dropdown-visible");
                }
            });

            $("#addNewIngredient").click(function() {
                var newInput = $("<div><input required type='text' value='' class='ingredients' name='ingredients'></input><a class='btn-floating btn-small waves-effect waves-light extraInput' onClick='removeInput(this)'><i class='material-icons'>delete</i></a></div>")
                $("#ingredients").append(newInput);
            });

            $("#addNewStep").click(function() {
                var newInput = $("<div><input required type='text' value='' class='method' name='method'></input><a class='btn-floating btn-small waves-effect waves-light extraInput' onClick='removeInput(this)'><i class='material-icons'>delete</i></a></div>")
                $("#method").append(newInput);
            });

            $("#addNewTag").click(function() {
                var newInput = $("<div><input required type='text' value='' class='tags' name='tags'></input><a class='btn-floating btn-small waves-effect waves-light extraInput' onClick='removeInput(this)'><i class='material-icons'>delete</i></a></div>")
                $("#tags").append(newInput);
            });
            // below function taken from https://devcenter.heroku.com/articles/s3-upload-python for uploading recipe images to S3
            // (function() {
            //     document.getElementById("recipe_url").onchange = function() {
            //         var files = document.getElementById("recipe_url").files;
            //         var file = files[0];
            //         if (!file) {
            //             return alert("No file selected.");
            //         }
            //         getSignedRequest(file);
            //     };
            // })();
            // function getSignedRequest(file) {
            //     var xhr = new XMLHttpRequest();
            //     xhr.open("GET", "/sign_s3?file_name=" + file.name + "&file_type=" + file.type);
            //     xhr.onreadystatechange = function() {
            //         if (xhr.readyState === 4) {
            //             if (xhr.status === 200) {
            //                 var response = JSON.parse(xhr.responseText);
            //                 uploadFile(file, response.data, response.url);
            //             }
            //             else {
            //                 alert("Could not get signed URL.");
            //             }
            //         }
            //     };
            //     xhr.send();
            // }
            // function uploadFile(file, s3Data, url) {
            //     var xhr = new XMLHttpRequest();
            //     xhr.open("POST", s3Data.url);

            //     var postData = new FormData();
            //     for (key in s3Data.fields) {
            //         postData.append(key, s3Data.fields[key]);
            //     }
            //     postData.append('file', file);

            //     xhr.onreadystatechange = function() {
            //         if (xhr.readyState === 4) {
            //             if (xhr.status === 200 || xhr.status === 204) {
            //                 document.getElementById("preview").src = url;
            //                 document.getElementById("recipe_url").value = url;
            //             }
            //             else {
            //                 alert("Could not upload file.");
            //             }
            //         }
            //     };
            //     xhr.send(postData);
            // }
            // end of code from heroku devcenter
        });
    </script>
</body>

</html>